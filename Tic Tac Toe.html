<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tic Tac Toe</title>
    <!-- Incluimos Tailwind CSS para los estilos -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Usamos la fuente Inter que viene con Tailwind */
        body {
            font-family: 'Inter', sans-serif;
        }
        /* Estilos para las 'X' y 'O' para que se vean nítidas y grandes */
        .cell-x svg {
            stroke: #60a5fa; /* text-blue-400 */
        }
        .cell-o svg {
            stroke: #facc15; /* text-yellow-400 */
        }
    </style>
</head>
<body class="bg-gray-900 text-white flex items-center justify-center min-h-screen p-4">

    <!-- Contenedor principal de la aplicación -->
    <main id="app-container" class="bg-gray-800 p-6 sm:p-8 rounded-2xl shadow-2xl w-full max-w-md">

        <!-- Pantalla 1: Menú Principal -->
        <div id="menu-screen" class="space-y-6">
            <h1 class="text-3xl font-bold text-center text-white">Tic Tac Toe</h1>
            <div class="space-y-4">
                <button id="btn-1p" class="w-full bg-indigo-600 hover:bg-indigo-700 text-white font-semibold py-3 px-4 rounded-lg transition-colors duration-200">
                    1 Jugador (vs IA)
                </button>
                <button id="btn-2p" class="w-full bg-cyan-600 hover:bg-cyan-700 text-white font-semibold py-3 px-4 rounded-lg transition-colors duration-200">
                    2 Jugadores
                </button>
            </div>
        </div>

        <!-- Pantalla 2: Selección de Dificultad (1P) -->
        <div id="difficulty-screen" class="hidden space-y-6">
            <h2 class="text-2xl font-bold text-center">Seleccionar Dificultad</h2>
            <div class="space-y-4">
                <button data-difficulty="EASY" class="btn-difficulty w-full bg-green-500 hover:bg-green-600 text-white font-semibold py-3 px-4 rounded-lg transition-colors duration-200">
                    Fácil
                </button>
                <button data-difficulty="NORMAL" class="btn-difficulty w-full bg-yellow-500 hover:bg-yellow-600 text-white font-semibold py-3 px-4 rounded-lg transition-colors duration-200">
                    Normal
                </button>
                <button data-difficulty="HARD" class="btn-difficulty w-full bg-red-500 hover:bg-red-600 text-white font-semibold py-3 px-4 rounded-lg transition-colors duration-200">
                    Difícil
                </button>
            </div>
            <button id="btn-back-to-menu-1" class="w-full text-gray-400 hover:text-white py-2 rounded-lg transition-colors duration-200">
                &larr; Volver al Menú
            </button>
        </div>

        <!-- Pantalla 3: Nombres de Jugadores (2P) -->
        <div id="names-screen" class="hidden space-y-6">
            <h2 class="text-2xl font-bold text-center">Nombres de Jugadores</h2>
            <form id="names-form" class="space-y-4">
                <div>
                    <label for="playerXName" class="block text-sm font-medium text-gray-300 mb-1">Nombre del Jugador "X"</label>
                    <input type="text" id="playerXName" class="w-full p-3 bg-gray-700 border border-gray-600 rounded-lg text-white" placeholder="Ej: Ana" required>
                </div>
                <div>
                    <label for="playerOName" class="block text-sm font-medium text-gray-300 mb-1">Nombre del Jugador "O"</label>
                    <input type="text" id="playerOName" class="w-full p-3 bg-gray-700 border border-gray-600 rounded-lg text-white" placeholder="Ej: Luis" required>
                </div>
                <p id="name-error" class="text-red-400 text-sm text-center hidden">Ambos campos son obligatorios.</p>
                <button type="submit" id="btn-start-pvp" class="w-full bg-cyan-600 hover:bg-cyan-700 text-white font-semibold py-3 px-4 rounded-lg transition-colors duration-200">
                    Empezar Juego
                </button>
            </form>
            <button id="btn-back-to-menu-2" class="w-full text-gray-400 hover:text-white py-2 rounded-lg transition-colors duration-200">
                &larr; Volver al Menú
            </button>
        </div>

        <!-- Pantalla 4: Juego -->
        <div id="game-screen" class="hidden space-y-5">
            <!-- Marcador / Estado -->
            <div class="flex justify-between items-center px-2">
                <span id="player-x-score" class="text-lg font-semibold text-blue-400">X: 0</span>
                <h2 id="status-text" class="text-xl font-bold text-center">Turno de X</h2>
                <span id="player-o-score" class="text-lg font-semibold text-yellow-400">O: 0</span>
            </div>

            <!-- Tablero -->
            <div id="board" class="grid grid-cols-3 gap-3 aspect-square">
                <!-- Las celdas se generan con JS, pero aquí hay un ejemplo de cómo se ven -->
                <!-- 
                <div class="w-full h-full bg-gray-700 rounded-lg flex items-center justify-center cursor-pointer hover:bg-gray-600 transition-colors" data-row="0" data-col="0"></div>
                ... 8 más ...
                -->
            </div>

            <!-- Botones de control del juego -->
            <div class="space-y-3 pt-2">
                <button id="btn-reset" class="w-full bg-red-600 hover:bg-red-700 text-white font-semibold py-3 px-4 rounded-lg transition-colors duration-200">
                    Reset (Reiniciar Partida)
                </button>
                <button id="btn-back-to-menu-3" class="w-full text-gray-400 hover:text-white py-2 rounded-lg transition-colors duration-200">
                    Volver al Menú Principal
                </button>
            </div>
        </div>

    </main>

    <!-- Pie de página fijo -->
    <footer class="fixed bottom-4 text-gray-500 text-sm">
        Made By Lizarazo
    </footer>

    <!-- Lógica del Juego en JavaScript -->
    <script>
        document.addEventListener('DOMContentLoaded', () => {

            // --- Referencias a Elementos DOM ---
            const screens = {
                menu: document.getElementById('menu-screen'),
                difficulty: document.getElementById('difficulty-screen'),
                names: document.getElementById('names-screen'),
                game: document.getElementById('game-screen'),
            };
            
            // Botones Menú Principal
            const btn1P = document.getElementById('btn-1p');
            const btn2P = document.getElementById('btn-2p');
            
            // Botones Dificultad
            const difficultyButtons = document.querySelectorAll('.btn-difficulty');
            
            // Formulario Nombres
            const namesForm = document.getElementById('names-form');
            const inputPlayerX = document.getElementById('playerXName');
            const inputPlayerO = document.getElementById('playerOName');
            const nameError = document.getElementById('name-error');
            
            // Botones "Volver"
            const btnBack1 = document.getElementById('btn-back-to-menu-1');
            const btnBack2 = document.getElementById('btn-back-to-menu-2');
            const btnBack3 = document.getElementById('btn-back-to-menu-3');
            
            // Elementos del Juego
            const boardElement = document.getElementById('board');
            const statusText = document.getElementById('status-text');
            const btnReset = document.getElementById('btn-reset');
            const scoreXElement = document.getElementById('player-x-score');
            const scoreOElement = document.getElementById('player-o-score');

            // --- SVGs para 'X' y 'O' ---
            const svgX = `
                <svg class="w-16 h-16 sm:w-20 sm:h-20" viewBox="0 0 24 24" fill="none" stroke-width="2.5" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
                </svg>`;
            const svgO = `
                <svg class="w-16 h-16 sm:w-20 sm:h-20" viewBox="0 0 24 24" fill="none" stroke-width="2.5" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                </svg>`;

            // --- Estado del Juego ---
            let board = [['', '', ''], ['', '', ''], ['', '', '']];
            let currentPlayer = 'X';
            let gameActive = true;
            let gameMode = null; // 'AI' o 'PVP'
            let aiDifficulty = null; // 'EASY', 'NORMAL', 'HARD'
            let playerNames = { X: 'Jugador X', O: 'Jugador O' };
            let scores = { X: 0, O: 0 };

            // --- Navegación entre Pantallas ---
            function showScreen(screenId) {
                Object.values(screens).forEach(screen => screen.classList.add('hidden'));
                if (screens[screenId]) {
                    screens[screenId].classList.remove('hidden');
                }
            }

            // --- Lógica de Navegación ---
            btn1P.addEventListener('click', () => {
                gameMode = 'AI';
                showScreen('difficulty');
            });
            
            btn2P.addEventListener('click', () => {
                gameMode = 'PVP';
                showScreen('names');
            });

            // Botones "Volver"
            [btnBack1, btnBack2, btnBack3].forEach(btn => {
                btn.addEventListener('click', () => {
                    fullResetGame(); // Reseteo completo al volver al menú
                });
            });

            // Selección de Dificultad
            difficultyButtons.forEach(btn => {
                btn.addEventListener('click', () => {
                    aiDifficulty = btn.dataset.difficulty;
                    playerNames = { X: 'Jugador', O: 'IA' };
                    startGame();
                });
            });

            // Formulario de Nombres (PVP)
            namesForm.addEventListener('submit', (e) => {
                e.preventDefault();
                const xName = inputPlayerX.value.trim();
                const oName = inputPlayerO.value.trim();

                if (xName === '' || oName === '') {
                    nameError.classList.remove('hidden');
                } else {
                    nameError.classList.add('hidden');
                    playerNames = { X: xName, O: oName };
                    startGame();
                }
            });
            
            // --- Lógica Principal del Juego ---
            
            function startGame() {
                gameActive = true;
                currentPlayer = 'X';
                board = [['', '', ''], ['', '', ''], ['', '', '']];
                createBoardUI();
                updateStatusText();
                updateScoreboard();
                showScreen('game');
            }

            // Resetea solo el tablero, mantiene puntajes y nombres
            function resetCurrentGame() {
                gameActive = true;
                currentPlayer = 'X';
                board = [['', '', ''], ['', '', ''], ['', '', '']];
                // Limpiar celdas visualmente
                boardElement.querySelectorAll('.cell').forEach(cell => {
                    cell.innerHTML = '';
                    cell.classList.remove('cell-x', 'cell-o');
                });
                updateStatusText();
            }
            
            // Reseteo completo: vuelve al menú y borra todo
            function fullResetGame() {
                scores = { X: 0, O: 0 };
                gameMode = null;
                aiDifficulty = null;
                inputPlayerX.value = '';
                inputPlayerO.value = '';
                nameError.classList.add('hidden');
                showScreen('menu');
            }

            btnReset.addEventListener('click', resetCurrentGame);

            // Crea el tablero visual
            function createBoardUI() {
                boardElement.innerHTML = '';
                for (let r = 0; r < 3; r++) {
                    for (let c = 0; c < 3; c++) {
                        const cell = document.createElement('div');
                        cell.className = 'cell w-full h-full bg-gray-700 rounded-lg flex items-center justify-center cursor-pointer hover:bg-gray-600 transition-colors';
                        cell.dataset.row = r;
                        cell.dataset.col = c;
                        cell.addEventListener('click', handleCellClick);
                        boardElement.appendChild(cell);
                    }
                }
            }

            function handleCellClick(e) {
                if (!gameActive) return;

                const cell = e.currentTarget;
                const row = cell.dataset.row;
                const col = cell.dataset.col;

                // Solo si la casilla está vacía
                if (board[row][col] === '') {
                    makeMove(row, col, currentPlayer);

                    // Si el juego no ha terminado, cambia de jugador
                    if (gameActive) {
                        currentPlayer = currentPlayer === 'X' ? 'O' : 'X';
                        updateStatusText();

                        // Turno de la IA
                        if (gameMode === 'AI' && currentPlayer === 'O') {
                            // Desactivar clics mientras piensa la IA
                            boardElement.style.pointerEvents = 'none';
                            setTimeout(() => {
                                makeAiMove();
                                boardElement.style.pointerEvents = 'auto';
                            }, 500); // 500ms de retraso
                        }
                    }
                }
            }

            function makeMove(row, col, player) {
                if (!gameActive || board[row][col] !== '') return;

                board[row][col] = player;
                drawMarker(row, col, player);

                if (checkWin(player)) {
                    gameActive = false;
                    statusText.innerText = `¡Gana ${playerNames[player]}! (${player})`;
                    scores[player]++;
                    updateScoreboard();
                } else if (checkDraw()) {
                    gameActive = false;
                    statusText.innerText = '¡Es un Empate!';
                }
            }

            function drawMarker(row, col, player) {
                const cell = boardElement.querySelector(`[data-row="${row}"][data-col="${col}"]`);
                if (player === 'X') {
                    cell.innerHTML = svgX;
                    cell.classList.add('cell-x');
                } else {
                    cell.innerHTML = svgO;
                    cell.classList.add('cell-o');
                }
            }

            function updateStatusText() {
                if (gameActive) {
                    statusText.innerText = `Turno de ${playerNames[currentPlayer]} (${currentPlayer})`;
                }
            }
            
            function updateScoreboard() {
                scoreXElement.innerText = `${playerNames.X} (X): ${scores.X}`;
                scoreOElement.innerText = `${playerNames.O} (O): ${scores.O}`;
            }

            function checkWin(player) {
                // Filas
                for (let r = 0; r < 3; r++) {
                    if (board[r][0] === player && board[r][1] === player && board[r][2] === player) return true;
                }
                // Columnas
                for (let c = 0; c < 3; c++) {
                    if (board[0][c] === player && board[1][c] === player && board[2][c] === player) return true;
                }
                // Diagonales
                if (board[0][0] === player && board[1][1] === player && board[2][2] === player) return true;
                if (board[0][2] === player && board[1][1] === player && board[2][0] === player) return true;
                
                return false;
            }

            function getEmptyCells() {
                const cells = [];
                for (let r = 0; r < 3; r++) {
                    for (let c = 0; c < 3; c++) {
                        if (board[r][c] === '') {
                            cells.push({ r, c });
                        }
                    }
                }
                return cells;
            }

            function checkDraw() {
                return getEmptyCells().length === 0 && !checkWin('X') && !checkWin('O');
            }

            // --- Lógica de la IA ---

            function makeAiMove() {
                if (!gameActive) return;
                
                let move;
                if (aiDifficulty === 'EASY') {
                    move = aiEasyMove();
                } else if (aiDifficulty === 'NORMAL') {
                    move = aiNormalMove();
                } else if (aiDifficulty === 'HARD') {
                    move = aiHardMove();
                }

                if (move) {
                    makeMove(move.r, move.c, 'O');
                    // Cambiar turno de vuelta al jugador
                    if (gameActive) {
                        currentPlayer = 'X';
                        updateStatusText();
                    }
                }
            }

            // IA Fácil: Movimiento aleatorio
            function aiEasyMove() {
                const emptyCells = getEmptyCells();
                return emptyCells[Math.floor(Math.random() * emptyCells.length)];
            }

            // IA Normal: 1. Gana, 2. Bloquea, 3. Aleatorio
            function aiNormalMove() {
                const emptyCells = getEmptyCells();
                
                // 1. Intentar ganar (IA - 'O')
                for (let cell of emptyCells) {
                    board[cell.r][cell.c] = 'O';
                    if (checkWin('O')) {
                        board[cell.r][cell.c] = ''; // Deshacer
                        return cell;
                    }
                    board[cell.r][cell.c] = ''; // Deshacer
                }
                
                // 2. Intentar bloquear (Jugador - 'X')
                for (let cell of emptyCells) {
                    board[cell.r][cell.c] = 'X';
                    if (checkWin('X')) {
                        board[cell.r][cell.c] = ''; // Deshacer
                        return cell;
                    }
                    board[cell.r][cell.c] = ''; // Deshacer
                }
                
                // 3. Aleatorio (como Fácil)
                return aiEasyMove();
            }

            // IA Difícil: Algoritmo Minimax
            function aiHardMove() {
                let bestScore = -Infinity;
                let bestMove;
                
                const emptyCells = getEmptyCells();

                for (let cell of emptyCells) {
                    board[cell.r][cell.c] = 'O'; // IA (Maximizador)
                    let score = minimax(board, 0, false); // Llama para el oponente (Minimizador)
                    board[cell.r][cell.c] = ''; // Deshacer
                    
                    if (score > bestScore) {
                        bestScore = score;
                        bestMove = cell;
                    }
                }
                return bestMove;
            }

            const scoresMinimax = {
                O: 10,  // IA Gana
                X: -10, // Jugador Gana
                TIE: 0  // Empate
            };

            function minimax(boardState, depth, isMaximizing) {
                // Casos base (fin de la recursión)
                if (checkWin('O')) return scoresMinimax.O - depth;
                if (checkWin('X')) return scoresMinimax.X + depth;
                if (checkDraw()) return scoresMinimax.TIE;

                const emptyCells = getEmptyCells();

                if (isMaximizing) { // Turno de la IA ('O')
                    let bestScore = -Infinity;
                    for (let cell of emptyCells) {
                        boardState[cell.r][cell.c] = 'O';
                        let score = minimax(boardState, depth + 1, false);
                        boardState[cell.r][cell.c] = '';
                        bestScore = Math.max(score, bestScore);
                    }
                    return bestScore;
                } else { // Turno del Jugador ('X')
                    let bestScore = Infinity;
                    for (let cell of emptyCells) {
                        boardState[cell.r][cell.c] = 'X';
                        let score = minimax(boardState, depth + 1, true);
                        boardState[cell.r][cell.c] = '';
                        bestScore = Math.min(score, bestScore);
                    }
                    return bestScore;
                }
            }

            // Iniciar la aplicación mostrando el menú
            showScreen('menu');
        });
    </script>

</body>
</html>
